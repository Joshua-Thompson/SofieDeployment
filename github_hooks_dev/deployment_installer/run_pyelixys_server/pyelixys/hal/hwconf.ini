#hwconf_hardware
#Order Matters!
#It determine the message structure:
## Mixers, Valves, Thermocouple,
## AuxThermocouple, Heaters, TemperatureControllers,
## SMCInterfaces, VacuumPump, Fans, LinearActuator, DigitalInputs,
## LiquidSensors


# These template files are used to auto-generate
# the C/C++ header files that describe the websocket
# elixys system status packet.  If you use these
# auto-generated files the python code will know how to
# properly unpack the packet into python data types

c_status_header_template = pyelixys/hal/statusmsg.h.jinja
c_status_source_template = pyelixys/hal/statusmsg.c.jinja
c_cmd_header_template = pyelixys/hal/cmdmsg.h.jinja
c_cmd_source_template = pyelixys/hal/cmdmsg.c.jinja


[Version]
    version = 1.3.0
    order = 31
    name = pyelixys

[Simulator]
    controlbox = False
    synthesizer = False

# The comports for accessing the ControlBox actuator board
[ControlBox]
    win_port = COM4
    posix_port = /dev/ttyACM0
    #for Mac OS: posix_port = /dev/tty.usbmodem1411
    baud = 9600
    
    # Multiple 3.3V / 4096
    ADCCONST0 = 0.0018081
    ADCCONST1 = 0.0018046    #0.0017976
    
    #ADCOFFSET0 = 9801.0
    ADCOFFSET0 = 9365.0
    ADCOFFSET1 = 9160.0    #9801.0
    
    # 39.0 psi / 2000
    DACCONST0 = 0.0205
    
    # 69.1 psi / 3330
    DACCONST1 = 0.02075


# Sections with "Message Format" sub-sections
# Are used to construct the status packet
# Section with "Commands" sub-sections are used
# to describe the format of commands to control
# the hardware


[Header]
    [[Message Format]]
        #--------#
        # Header #
        #--------#
        # Packet Type byte|'i'|4|'?'(status)
        # Packet ID Num unsigned int|'i'|4|0-4294967295(client auto increments)
        # System Error Code unsigned int|'i'|4|0-4294967295
        packet_type = i
        packet_id = I
        system_error_code = i
    [[Units]]
    [[Commands]]

[Mixers]
    count = 4
    [[Units]]
        [[[1]]]
            name = Reactor1
        [[[2]]]
            name = Reactor2
    
    [[Message Format]]
        #-------#
        # Mixer #
        #-------#
        # Mixer error code unsigned char|'c'|1|See docs
        # Mixer 0 period setting microseconds|'i'|4|0-2147483647
        # Mixer 0 duty cycle percentage|'f'|4|0-1.0
        # Mixer 1 period setting microseconds|'i'|4|0-2147483647
        # Mixer 1 duty cycle percentage|'f'|4|0-1.0
        # Mixer 2 period setting microseconds|'i'|4|0-2147483647
        # Mixer 2 duty cycle percentage|'f'|4|0-1.0
        # Mixer 3 period setting microseconds|'i'|4|0-2147483647
        # Mixer 3 duty cycle percentage|'f'|4|0-1.0
        error_code = c
        [[[Repeat]]]
            period = i
            duty_cycle = f
    [[Commands]]
        set_period = 1, i
        set_duty_cycle = 2, f

[Valves]
    groups = 3
    count = 48
    [[Message Format]]
        #--------#
        # Valves #
        #--------#
        # Valves error code |'c'|1|See docs
        # Valves state|'hhh'|48 bits set valves to on or off
        error_code = c
        state0 = H
        state1 = H
        state2 = H
    [[Commands]]
        set_state0 = 3, H
        set_state1 = 4, H
        set_state2 = 5, H
    [[Units]]

[Thermocouples]
    count = 9
    short_name = Thermo
    [[Message Format]]
        #---------------#
        # Thermocouples #
        #---------------#
        # Thermocouple 0 current temp |'f'|4|Decimal temperature
        # Thermocouple 0 error code |'c'|1|See docs
        # Thermocouple 1 current temp |'f'|4|Decimal temperature
        # Thermocouple 1 error code |'c'|1|See docs
        # Thermocouple 2 current temp |'f'|4|Decimal temperature
        # Thermocouple 2 error code |'c'|1|See docs
        # Thermocouple 3 current temp |'f'|4|Decimal temperature
        # Thermocouple 3 error code |'c'|1|See docs
        # Thermocouple 4 current temp |'f'|4|Decimal temperature
        # Thermocouple 4 error code |'c'|1|See docs
        # Thermocouple 5 current temp |'f'|4|Decimal temperature
        # Thermocouple 5 error code |'c'|1|See docs
        # Thermocouple 6 current temp |'f'|4|Decimal temperature
        # Thermocouple 6 error code |'c'|1|See docs
        # Thermocouple 7 current temp |'f'|4|Decimal temperature
        # Thermocouple 7 error code |'c'|1|See docs
        # Thermocouple 8 current temp |'f'|4|Decimal temperature
        # Thermocouple 8 error code |'c'|1|See docs
        [[[Repeat]]]
            error_code = c
            temperature = f
    [[Units]]
    [[Commands]]

[AuxThermocouples]
    short_name = AuxTherm
    count = 3
    [[Message Format]]
        #-------------------#
        # Aux Thermocouples #
        #-------------------#
        # Aux Thermocouple 0 current temp |'f'|4|Decimal temperature
        # Aux Thermocouple 0 error code |'c'|1|See docs
        # Aux Thermocouple 1 current temp |'f'|4|Decimal temperature
        # Aux Thermocouple 1 error code |'c'|1|See docs
        # Aux Thermocouple 2 current temp |'f'|4|Decimal temperature
        # Aux Thermocouple 2 error code |'c'|1|See docs
        [[[Repeat]]]
            error_code = c
            temperature = f
    [[Units]]
    [[Commands]]

[Heaters]
    count = 9
    [[Message Format]]
        #---------#
        # Heaters #
        #---------#
        # Heaters State|'h'|1|See docs
        state = h
    [[Units]]
    [[Commands]]

[TemperatureControllers]
    count = 9
    short_name = TempCtrl
    [[Message Format]]
        #------------------#
        # Temp Controllers #
        #------------------#
        # Temp Controller 0 error code|'c'|1|See docs
        # Temp Controller 0 setpoint|'f'|1|See docs
        # Temp Controller 1 error code|'c'|1|See docs
        # Temp Controller 1 setpoint|'f'|1|See docs
        # Temp Controller 2 error code|'c'|1|See docs
        # Temp Controller 2 setpoint|'f'|1|See docs
        error_code = I
        [[[Repeat]]]
            error_code = c
            setpoint = f
    [[Commands]]
        set_setpoint = 6, f
        turn_on = 7, c
        turn_off = 8, c
    [[Units]]

[SMCInterfaces]
    analog_in_vref = 4.125
    count = 2
    short_name = SMCIntf
    [[Message Format]]
        #---------------#
        # SMC Interface #
        #---------------#
        # SMC Interfaces  error code|'c'|1|See docs
        # SMC Interface 0 Analog Out|'f'|4|0-10.0V
        # SMC Interface 0 Analog In|'f'|4|0-5.0V
        # SMC Interface 1 Analog Out|'f'|4|0-10.0V
        # SMC Interface 1 Analog In|'f'|4|0-5.0V
        error_code = c
        [[[Repeat]]]
            analog_out = f
            analog_in = f
    
    [[Commands]]
        set_analog_out = 9, f
    [[Units]]


[Fans]
    count = 3
    [[Message Format]]
        #------#
        # Fans #
        #------#
        # Fan status byte (3 bit)|'c'|See docs
        state = c
    
    [[Commands]]
        turn_on = 10, c
        turn_off = 11, c
    [[Units]]

[LinearActuators]
    short_name = LinAct
    count = 5
    [[Message Format]]
        error_code = I
        #-----------------#
        # Linear Actuator #
        #-----------------#
        # Axis 0 Position steps (unsigned int)|'I'|0-4294967295
        # Axis 0 Requested Position steps (unsigned int)|'I'|0-4294967295
        # Axis 0 error code|'I'|4|0-4294967295
        # Axis 1 Position steps (unsigned int)|'I'|0-4294967295
        # Axis 1 Requested Position steps (unsigned int)|'I'|0-4294967295
        # Axis 1 error code|'I'|4|0-4294967295
        # Axis 2 Position steps (unsigned int)|'I'|0-4294967295
        # Axis 2 Requested Position steps (unsigned int)|'I'|0-4294967295
        # Axis 2 error code|'I'|4|0-4294967295
        # Axis 3 Position steps (unsigned int)|'I'|0-4294967295
        # Axis 3 Requested Position steps (unsigned int)|'I'|0-4294967295
        # Axis 3 error code|'I'|4|0-4294967295
        # Axis 4 Position steps (unsigned int)|'I'|0-4294967295
        # Axis 4 Requested Position steps (unsigned int)|'I'|0-4294967295
        # Axis 4 error code|'I'|4|0-4294967295
        [[[Repeat]]]
            position = i
            requested_position = I
            error_code = I
    
    [[Commands]]
        set_requested_position = 12, i
        home_axis = 13, c
        gateway_start = 14, c
        turn_on = 15, c
        pause = 16, c
        start = 17, c
        brake_release = 18, c
        reset = 19, c
    [[Units]]

[DigitalInputs]
    short_name = DigiIn
    count = 12
    [[Message Format]]
        #----------------#
        # Digital Inputs #
        #----------------#
        # Digital input error code |'c'|1|See docs
        # Digital input state (12bits)|'H'|2|See Docs
        error_code = c
        state = H
    [[Units]]
    [[Commands]]


[LiquidSensors]
    no_liquid_present_counts = 34.0    #Value in counts from adc conversion in fw. Tube present but no liquid
    liquid_present_counts = 40.0    #Value in counts from adc conversion in fw. Tube present with liquid
    no_tube_present_counts = 52.0    #no tube or liquid
    acceptable_low_range = 0.95    # When No Tube and Tube w/ Liquid readings are very close (within these ranges)
    acceptable_high_range = 1.05    # We treat it as having liquid
    max_liquid_checks = 20.0
    short_name = LiqSens
    count = 8
    [[Message Format]]
        #----------------#
        # Liquid Sensors #
        #----------------#
        # Liquid sensor error code|'c'|1|See docs
        # Liquid sensor 0 Analog In|'f'|4|0-3.3V
        # Liquid sensor 1 Analog In|'f'|4|0-3.3V
        # Liquid sensor 2 Analog In|'f'|4|0-3.3V
        # Liquid sensor 3 Analog In|'f'|4|0-3.3V
        # Liquid sensor 4 Analog In|'f'|4|0-3.3V
        # Liquid sensor 5 Analog In|'f'|4|0-3.3V
        # Liquid sensor 6 Analog In|'f'|4|0-3.3V
        # Liquid sensor 7 Analog In|'f'|4|0-3.3V
        error_code = c
        [[[Repeat]]]
            analog_in = f
    [[Units]]
    [[Commands]]

[RadiationSensors]
    short_name = RadSens
    count = 11
    
    [[Message Format]]
        #-------------------#
        # Radiation Sensors #
        #-------------------#
        # Liquid sensor error code|'c'|1|See docs
        # Liquid sensor 0 Analog In|'I'|4|0-4.096V
        # Liquid sensor 1 Analog In|'I'|4|0-4.096V
        # Liquid sensor 2 Analog In|'I'|4|0-4.096V
        # Liquid sensor 3 Analog In|'I'|4|0-4.096V
        # Liquid sensor 4 Analog In|'I'|4|0-4.096V
        # Liquid sensor 5 Analog In|'I'|4|0-4.096V
        # Liquid sensor 6 Analog In|'I'|4|0-4.096V
        # Liquid sensor 7 Analog In|'I'|4|0-4.096V
        # Liquid sensor 8 Analog In|'I'|4|0-4.096V
        # Liquid sensor 9 Analog In|'I'|4|0-4.096V
        # Liquid sensor 10 Analog In|'I'|4|0-4.096V
        [[[Repeat]]]
            analog_in = I
    [[Units]]
    [[Commands]]

[VacuumPump]
    short_name = VacuumPump
    count = 1
    [[Message Format]]
        state = h
    
    [[Commands]]
        turn_on = 20, h
        turn_off = 21, h
    [[Units]]

[HplcValve]
    selected_sensor_number = 0    #change this to use different liq sens on synth board
    transfer_position_i2c = 1
    transfer_position_logic_level = 3
    stop_position_i2c = 2
    stop_position_logic_level = 4
    short_name = HplcValve
    count = 1
    
    [[Message Format]]
        position = h
        error = h
    
    [[Commands]]
        set_position = 22, h
    [[Units]]

[Commands]
    initialize_system = 23

# This special section describes the "Command Format"
# The command communication packet starts with a cmd_id
# an integer that tells which callback to execute on the
# hardware.  Since many subsystems on the elixys hardware
# have multiple units, a device id is also included.
# The Max parameter size is also set here, and used
# to properly construct the C/C++ command header file

[Command Format]
    parameter_sz = 512
    [[Packet Structure]]
        cmd_id = i
        device_id = i
        parameter = c

[Reactors]
    
    # Number of reactors in the system
    
    [[Reactor0]]
        
        # Reactor ID
        id = 0
        
        # Linear Actuator id
        actuator_id = 2
        
        # Thermocouple ids
        thermocouple_ids = 0, 1, 2
        
        # Temperature control ids
        tempctrl_ids = 0, 1, 2
        
        # Stopcock ids
        stopcock_ids = 0, 1, 2
        
        # Mixer id
        mixer_id = 0
        
        # Mixer duty cycle for normal operation
        mixer_nominal_duty_cycle = 1.35
        
        # Sensor ids
        [[[Sensors]]]
            up = 0
            down = 1
        
        # Valve ids
        [[[Valves]]]
            up = 0
            down = 1
        
        #RadSensor ids
        [[[RadSensors]]]
            reactor = 7
            cartridgeA = 6
            cartridgeB = 10
        
        [[[Positions]]]
            install = 0.03
            transfer = 28.98
            add = 84.45
            react0 = 111.37
            react1 = 140.75
            evaporate = 157.93
    
    [[Reactor1]]
        
        # Reactor ID
        id = 1
        
        # Linear Actuator id
        actuator_id = 3
        
        
        # Thermocouple ids
        thermocouple_ids = 3, 4, 5
        
        # Temperature Controller id
        tempctrl_ids = 3, 4, 5
        
        # Stopcock ids
        stopcock_ids = 3, 4, 5
        
        # Mixer id
        mixer_id = 1
        
        # Mixer duty cycle for normal operation
        mixer_nominal_duty_cycle = 1.35
        
        # Sensor ids
        [[[Sensors]]]
            up = 2
            down = 3
        
        # Valve ids
        [[[Valves]]]
            up = 2
            down = 3
        
        #RadSensor ids
        [[[RadSensors]]]
            reactor = 3
            cartridgeA = 10
            cartridgeB = 4
        
        [[[Positions]]]
            install = 0.0
            transfer = 32.12
            add = 86.19
            react0 = 115.5
            react1 = 140.75
            evaporate = 160.76
    
    [[Reactor2]]
        
        # Reactor ID
        id = 2
        
        # Linear Actuator id
        actuator_id = 4
        
        # Thermocouple ids
        thermocouple_ids = 6, 7, 8
        
        # Temperature control ids
        tempctrl_ids = 6, 7, 8
        
        # Stopcock ids
        stopcock_ids = 6, 7, 8
        
        # Mixer id
        mixer_id = 2
        
        # Mixer duty cycle for normal operation
        mixer_nominal_duty_cycle = 1.35
        
        [[[Sensors]]]
            # Sensor ids
            up = 4
            down = 5
        
        [[[Valves]]]
            # Valve ids
            up = 4
            down = 5
        
        #RadSensor ids
        [[[RadSensors]]]
            reactor = 5
            cartridgeA = 4
            cartridgeB = 0
        
        [[[Positions]]]
            install = 0.0
            transfer = 31.13
            add = 88.35
            react0 = 115.5
            react1 = 140.75
            evaporate = 160.49


[LinearAxis]
    [[LinearAxis0]]
        id = 0
        MAX = 350.0
    
    [[LinearAxis1]]
        id = 1
        MAX = 100.0
    
    [[LinearAxis2]]
        id = 2
        MAX = 250.0
    
    [[LinearAxis3]]
        id = 3
        MAX = 250.0
    
    [[LinearAxis4]]
        id = 4
        MAX = 250.0


[Stopcocks]
    
    [[Stopcock0]]
        id = 0
        [[[Valves]]]
            CW = 6
            CCW = 7
    
    [[Stopcock1]]
        id = 1
        [[[Valves]]]
            CW = 8
            CCW = 9
    
    [[Stopcock2]]
        id = 2
        [[[Valves]]]
            CW = 10
            CCW = 11
    
    [[Stopcock3]]
        id = 3
        [[[Valves]]]
            CW = 12
            CCW = 13
    
    [[Stopcock4]]
        id = 4
        [[[Valves]]]
            CW = 14
            CCW = 15
    
    [[Stopcock5]]
        id = 5
        [[[Valves]]]
            CW = 16
            CCW = 17
    
    [[Stopcock6]]
        id = 6
        [[[Valves]]]
            CW = 18
            CCW = 19
    
    [[Stopcock7]]
        id = 7
        [[[Valves]]]
            CW = 20
            CCW = 21
    
    [[Stopcock8]]
        id = 8
        [[[Valves]]]
            CW = 22
            CCW = 23


[Gripper]
    
    
    [[Sensors]]
        up = 6
        down = 7
        open = 10
        close = 11
    
    
    # Valve ids
    [[Valves]]
        up = 24
        down = 25
        open = 28
        close = 29


[GasTransfer]
    
    [[Sensors]]
        up = 8
        down = 9
    
    # Valve ids
    [[Valves]]
        up = 26
        down = 27
        transfer = 33


[ReagentRobot]
    xaxis_actuator_id = 0
    yaxis_actuator_id = 1
    
    [[Positions]]
        [[[Reactor0]]]
            install = 0.0, 0.0
            reagent0 = 314.45, 1.21
            reagent1 = 292.59, 1.19
            reagent2 = 270.51, 1.39
            reagent3 = 313.49, 21.31
            reagent4 = 270.5, 22.04
            reagent5 = 315.18, 42.13
            reagent6 = 272.01, 42.0
            reagent7 = 314.45, 62.09
            reagent8 = 271.61, 62.04
            reagent9 = 316.22, 82.67
            reagent10 = 293.79, 82.31
            reagent11 = 271.5, 81.72
            add0 = 293.33, 41.15
            add1 = 293.55, 61.88
            elute = 293.07, 21.0
            evaporate = 271.5, 20.96
            transfer = 270.56, 81.35
        
        [[[Reactor1]]]
            install = 0.0, 0.0
            reagent0 = 180.05, 1.21
            reagent1 = 157.98, 1.56
            reagent2 = 135.78, 0.96
            reagent3 = 179.58, 21.07
            reagent4 = 136.61, 20.96
            reagent5 = 179.7, 41.75
            reagent6 = 136.14, 41.64
            reagent7 = 180.29, 61.86
            reagent8 = 136.74, 61.97
            reagent9 = 180.44, 81.98
            reagent10 = 158.69, 81.86
            reagent11 = 136.97, 81.78
            add0 = 158.69, 41.17
            add1 = 158.21, 61.67
            elute = 158.34, 20.9
            evaporate = 137.33, 20.51
            transfer = 137.33, 81.06
        
        [[[Reactor2]]]
            install = 0.0, 0.0
            reagent0 = 44.58, 1.19
            reagent1 = 22.74, 0.14
            reagent2 = 1.41, 1.2
            reagent3 = 44.58, 21.48
            reagent4 = 1.77, 21.49
            reagent5 = 44.51, 41.71
            reagent6 = 1.26, 41.51
            reagent7 = 45.15, 61.58
            reagent8 = 2.22, 62.24
            reagent9 = 45.54, 82.51
            reagent10 = 23.91, 81.36
            reagent11 = 2.07, 81.83
            add0 = 23.48, 41.09
            add1 = 23.82, 61.09
            elute = 23.36, 20.48
            evaporate = 2.24, 20.83
            transfer = 3.24, 81.41

[F18]
    # Valve ids
    [[Valves]]
        transfer = 32

[PressureRegulators]
    min_pneumatic_pressure = 60.0
    [[PressureRegulator0]]
        id = 0
        PSICONV = 1.0
    [[PressureRegulator1]]
        id = 1
        PSICONV = 1.0

[CoolantPump]
    id = 0
[Cameras]
    [[Camera0]]
    [[Camera1]]
    [[Camera2]]
